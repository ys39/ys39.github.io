---
title: 'モノレポとは(WIP)'
date: '2024-10-14'
---

### はじめに

- 正直、モノレポという言葉を知らない。ただ、Webアプリケーションの開発現場で、モノレポを使用しているケースが多々あり、その目的やメリットを知っておくべきである。そこで、今回はモノレポとは何かという基本的な概念を掴み、NXというモノレポツールを利用して、ざっとした使い方を学習する。

### モノレポとは

- 全てのコードベースを単一のリポジトリに管理すること。通常、それぞれのプロジェクトごとに別々のリポジトリを作成するが、モノレポでは全てのプロジェクトが一つのリポジトリで管理されるのが特徴。
- 反対に、各プロジェクトやパッケージごとに別々のリポジトリを作成して管理する方法を**ポリレポ**と呼び、従来から多くの開発チームで使用されてきた一般的なリポジトリ運用の形式。

### モノレポのメリット

- **コードの一貫性** .. 一つのリポジトリでコードを管理するため、異なるプロジェクト間での依存関係のバージョン管理やコードの共有が簡単になる。
- **依存関係の管理** .. 同じリポジトリにあるため、プロジェクト同士の依存関係が明確で管理しやすくなる。例えば、バックエンドとフロントエンドで共通のライブラリが使われている場合に、それらを簡単に更新したりバージョン管理できる。
- **統一された開発環境** .. ビルドツールやテスト環境を一つのリポジトリで管理できるため、全体的な開発体験が一貫する。
- **リポジトリの一元化** .. 全てのプロジェクトが一つのリポジトリにあるため、アクセスが簡単で、CI/CDパイプ
  ラインのセットアップも一括して行える。（ポリレポの場合だと、各担当チームが別々にメンテナンスを行うため、システムに関する知識が分散し、システム全体をビルドしてデプロイする方法を確立するのが難しい）

### モノレポに関する誤解とその解決策

- **複数のプログラミング言語やツールの使用とビルドの統一性** .. 複数の言語やツールを使用する場合でも、コンテナ化を活用することで、各マイクロサービスのビルドを独立して管理でき、モノレポでも問題が発生しにくい。
- **モノレポとコードの密結合** .. モノレポを使用することでコードが密結合になるという誤解があるが、適切な設計とベストプラクティスを守れば、コードの独立性を維持できる。
- **マイクロサービスの更新管理** .. モノレポではマイクロサービスの個別更新が難しいと言われがちだが、ブルーグリーンデプロイやカナリアデプロイなどのデプロイ戦略を用いることで問題を解決できる。
- **CI/CD パイプラインによる自動化** .. 自動化されたCI/CDパイプラインを導入すれば、モノレポの運用による問題を解消できる。各マイクロサービスはコンテナ化されているため、個別の開発、テスト、デプロイが可能。
- **大規模モノレポのスケーリング** .. モダンなCI/CDツールを活用することで、モノレポが大規模になっても、個別のビルドやテスト、デプロイが容易に行える。

### モノレポツールの種類

- NX
- Turborepo
- Lerna

### モノレポを採用している企業事例

- identify株式会社 (2023-05-29時点) では、動画素材サービス「DeLMO」を運営しており、フロントエンドには3つの環境がある。これらを1つのリポジトリで管理するモノレポ構成を、Nxを使って実現していた。
- ファインディ株式会社 (2024-08-05時点) では、主にフロントエンドのリポジトリをモノレポとして運用している。
- メルカリShops (2021-08-18時点) では、各言語ごとにルートディレクトリが分割されており、それらの配下にそれぞれのapplication codeがある。BackendとなるMicroservicesにはGoを採用しており、BFF, FrontendにはTypeScriptを採用しているため、Go以下にMicroservices群、typescript以下にGraphQL, Web Frontendなどが配置されている。

### まとめ

### 参考

- [Findy Tech Blog](https://tech.findy.co.jp/entry/2024/08/05/090000)
- [circle ciブログ](https://circleci.com/ja/blog/monorepo-dev-practices/)
- [DeLMO Tech Blog](https://tech.delm0.jp/entry/2023/05/29/161202)
- [mercari engineering](https://engineering.mercari.com/blog/entry/20210817-8f561697cc/)
